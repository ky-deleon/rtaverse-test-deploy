<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RTAverse</title>
    <link rel="stylesheet" href="../static/styles.css" />
    <link rel="stylesheet" href="../static/dashboard.css" />
    <link rel="stylesheet" href="../static/filter-dashboard.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script defer src="../static/script.js"></script>
  </head>

  <body class="rtaverse">
    <div class="pagesize">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div>
          <!-- Sidebar Header (Toggle + Title) -->
          <div class="sidebar-header">
            <button
              class="sidebar-toggle"
              onclick="toggleSidebar()"
              aria-label="Toggle sidebar"
            >
              <svg
                id="toggle-icon"
                xmlns="http://www.w3.org/2000/svg"
                height="24px"
                viewBox="0 -960 960 960"
                width="24px"
                fill="#0437F2"
              >
                <!-- Default: open state -->
                <path
                  d="M689-365v-230q0-21-19.5-29.5T635-618l-93 93q-19 19-19 45t19 45l93 93q15 15 34.5 6.5T689-365ZM212-86q-53 0-89.5-36.5T86-212v-536q0-53 36.5-89.5T212-874h536q53 0 89.5 36.5T874-748v536q0 53-36.5 89.5T748-86H212Zm226-126h310v-536H438v536Z"
                />
              </svg>
            </button>
            <p class="app-title">RTAVERSE</p>
          </div>

          <!-- Gradient line -->
          <div class="gradient-line"></div>

          <!-- Navigation -->
          <nav class="nav">
            <a href="{{ url_for('auth.dashboard') }}" class="nav-item active">
              <svg class="icon" viewBox="0 -960 960 960" fill="currentColor">
                <path
                  d="M126-212v-342q0-30 13-56.5t37-44.5l228-171q34-26 76-26t76 26l228 171q24 18 37 44.5t13 56.5v342q0 53-36.5 89.5T708-86h-77q-26 0-44.5-18.5T568-149v-196q0-26-18.5-44.5T505-408h-50q-26 0-44.5 18.5T392-345v196q0 26-18.5 44.5T329-86h-77q-53 0-89.5-36.5T126-212Z"
                />
              </svg>
              <span>Dashboard</span>
            </a>

            <a href="{{ url_for('views.graphs') }}" class="nav-item">
              <svg class="icon" viewBox="0 -960 960 960" fill="currentColor">
                <path
                  d="M706-126q-26 0-44.5-18.5T643-189v-202q0-26 18.5-44.5T706-454h65q26 0 44.5 18.5T834-391v202q0 26-18.5 44.5T771-126h-65Zm-258 0q-26 0-44.5-18.5T385-189v-582q0-26 18.5-44.5T448-834h64q26 0 44.5 18.5T575-771v582q0 26-18.5 44.5T512-126h-64Zm-259 0q-26 0-44.5-18.5T126-189v-382q0-26 18.5-44.5T189-634h65q26 0 44.5 18.5T317-571v382q0 26-18.5 44.5T254-126h-65Z"
                />
              </svg>
              <span>Graphs</span>
            </a>

            <a href="{{ url_for('views.database_page') }}" class="nav-item">
              <svg class="icon" viewBox="0 -960 960 960" fill="currentColor">
                <path
                  d="M479-523q165 0 280-52t115-124q0-73-115-124t-280-51q-165 0-279 51T86-699q0 72 114 124t279 52Zm1 88q72 0 142.5-12.5T749-483q56-23 91-55.5t35-72.5v130q0 40-35 72.5T749-353q-56 23-126.5 35.5T480-305q-72 0-142.5-12.5T211-353q-56-23-91-55.5T85-481v-130q0 40 35 72.5t91 55.5q56 23 126.5 35.5T480-435Zm0 218q72 0 142.5-12.5t126.5-36q56-23.5 91-56t35-72.5v131q0 40-35 72.5T749-135q-56 23-126.5 35.5T480-87q-72 0-142.5-12.5T211-135q-56-23-91-55.5T85-263v-131q0 40 35 72.5t91 55.5q56 23 126.5 36T480-217Z"
                />
              </svg>
              <span>Database</span>
            </a>
          </nav>
        </div>

        <!-- Logout -->
        <a href="#" class="nav-item logout" onclick="openLogoutModal(event)">
          <svg class="icon" viewBox="0 -960 960 960" fill="currentColor">
            <path
              d="M212-86q-53 0-89.5-36.5T86-212v-536q0-53 36.5-89.5T212-874h213q26 0 44.5 18.5T488-811q0 26-18.5 44.5T425-748H212v536h213q26 0 44.5 18.5T488-149q0 26-18.5 44.5T425-86H212Zm423-331H415q-26 0-44.5-18.5T352-480q0-26 18.5-44.5T415-543h220l-52-52q-18-18-18-44t18-44q18-19 43.5-19t44.5 19l159 159q18 19 18 44t-18 44L671-277q-18 19-44 19t-44-19q-18-18-18-44t18-44l52-52Z"
            />
          </svg>
          <span>Logout</span>
        </a>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Header -->
        <div class="breadcrumbs">Pages / Dashboard</div>

        <div class="header">
          <p class="page-title">Maps</p>

          <div class="header-controls">
            <!-- Search Box -->
            <div class="search-box">
              <input
                type="text"
                placeholder="Search"
                oninput="toggleSearchIcon(this)"
              />
              <svg
                class="search-icon"
                xmlns="http://www.w3.org/2000/svg"
                height="20px"
                viewBox="0 -960 960 960"
                width="20px"
                fill="#0437F2"
              >
                <path
                  d="M380-320q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l224 224q11 11 11 28t-11 28q-11 11-28 11t-28-11L532-372q-30 24-69 38t-83 14Zm0-80q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"
                />
              </svg>
            </div>
            <!-- Filter Button (Icon Only) -->
            <button class="filter-btn" onclick="openFilterModal()">
              <svg
                class="filter-icon"
                xmlns="http://www.w3.org/2000/svg"
                height="24px"
                viewBox="0 -960 960 960"
                width="24px"
                fill="#0437F2"
              >
                <path
                  d="M440-126q-30 0-52-22t-22-52v-228L142-716q-29-37-9-77.5t67-40.5h560q47 0 67 40.5t-9 77.5L594-428v239q0 27-18 45t-45 18h-91Z"
                />
              </svg>
            </button>
            <!-- User Avatar -->
            <img
              src="https://4kwallpapers.com/images/walls/thumbs_3t/14563.jpg"
              alt="User Avatar"
              class="user-avatar"
            />
          </div>
        </div>
        <!-- End of Header -->

        {% if forecast_source %}
        <p style="margin: 6px 0; color: #666">
          Forecast data source: <strong>{{ forecast_source }}</strong>
        </p>
        {% endif %}

        <section class="cards-grid">
          <div class="card">
            <div class="card-label">Date</div>
            <div id="cardDate" class="card-value" data-live="true">
              {{ current_date|default('—', true) }}
            </div>
          </div>
          <div class="card">
            <div class="card-label">Time</div>
            <div id="cardTime" class="card-value" data-live="true">
              {{ current_time|default('—', true) }}
            </div>
          </div>
          <div class="card col-span-2">
            <div class="card-label">Risks (Legend)</div>
            <div class="legend">
              <span><span class="dot green"></span>Low Risk</span>
              <span><span class="dot yellow"></span>Moderate Risk</span>
              <span><span class="dot red"></span>High Risk</span>
            </div>
          </div>
        </section>

        <!-- Map -->
        <div class="map-wrapper">
          {% if no_data_html %} {{ no_data_html|safe }} {% else %}
          <!-- put this anywhere on the page (e.g., near the iframe) -->
          <div
            id="map-endpoint"
            data-url="{{ url_for('api.folium_map') }}"
          ></div>
          <iframe
            class="map-frame"
            src="{{ url_for('api.folium_map') }}"
            style="width: 100%; height: 600px; border: 0"
          ></iframe>
          {% endif %}
        </div>
      </main>
    </div>

    <!-- Logout Modal -->
    <div id="logoutModal" class="modal hidden">
      <div class="modal-content">
        <p>Are you sure you want to logout?</p>
        <div class="modal-buttons">
          <button onclick="confirmLogout()">Yes</button>
          <button onclick="closeLogoutModal()">No</button>
        </div>
      </div>
    </div>

    <!-- Filter Modal -->
    <div id="filterModal" class="filter-modal hidden">
      <div class="filter-modal-content">
        <!-- Close Button -->
        <button class="filter-close-btn" onclick="closeFilterModal()">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="24px"
            viewBox="0 -960 960 960"
            width="24px"
            fill="#0437F2"
          >
            <path
              d="m291-240-51-51 189-189-189-189 51-51 189 189 189-189 51 51-189 189 189 189-51 51-189-189-189 189Z"
            />
          </svg>
        </button>

        <!-- Location Filter -->
        <div class="filter-group">
          <label class="filter-label">Location</label>
          <div class="filter-dropdown">
            <select id="locationFilter" class="filter-select">
              <option value="">Select location</option>
              <option value="agapito-del-rosario">Agapito Del Rosario</option>
              <option value="amsic">Amsic</option>
              <option value="anunas">Anunas</option>
              <option value="balibago">Balibago</option>
              <option value="capaya">Capaya</option>
              <option value="claro-m-recto">Claro M. Recto</option>
              <option value="cuayan">Cuayan</option>
              <option value="cutcut">Cutcut</option>
              <option value="cutud">Cutud</option>
              <option value="lourdes-north-west">Lourdes North West</option>
              <option value="lourdes-sur">Lourdes Sur</option>
              <option value="lourdes-sur-east">Lourdes Sur East</option>
              <option value="malabanas">Malabanas</option>
              <option value="margot">Margot</option>
              <option value="marisol">Marisol</option>
              <option value="mining">Mining</option>
              <option value="pampang">Pampang</option>
              <option value="pandan">Pandan</option>
              <option value="pulung-bulu">Pulung Bulu</option>
              <option value="pulung-cacutud">Pulung Cacutud</option>
              <option value="pulung-maragul">Pulung Maragul</option>
              <option value="salapungan">Salapungan</option>
              <option value="san-jose">San Jose</option>
              <option value="san-nicolas">San Nicolas</option>
              <option value="santa-teresita">Santa Teresita</option>
              <option value="santa-trinidad">Santa Trinidad</option>
              <option value="santo-cristo">Santo Cristo</option>
              <option value="santo-domingo">Santo Domingo</option>
              <option value="sapalibutad">Sapalibutad</option>
              <option value="sapangbato">Sapangbato</option>
              <option value="tabun">Tabun</option>
              <option value="virgen-delos-remedios">
                Virgen Delos Remedios
              </option>
            </select>
            <svg
              class="dropdown-arrow"
              xmlns="http://www.w3.org/2000/svg"
              height="20px"
              viewBox="0 -960 960 960"
              width="20px"
              fill="#0437F2"
            >
              <path
                d="M480-373 267-586q-18-18-8.5-43t36.5-25h350q27 0 36.5 25t-8.5 43L480-373Z"
              />
            </svg>
          </div>
        </div>

        <!-- Date -->
        <div class="filter-group">
          <label class="filter-label">Date</label>
          <div class="month-range">
            <input
              type="month"
              id="monthFrom"
              class="filter-date-input"
              min="2015-01"
              max="2025-12"
            />
            <span class="time-separator">to</span>
            <input
              type="month"
              id="monthTo"
              class="filter-date-input"
              min="2015-01"
              max="2025-12"
            />
          </div>
          <div id="dateError" class="date-error-message hidden">
            Please choose months between 2015 and 2025. “From” cannot be after
            “To”.
          </div>
        </div>

        <!-- Time Filter -->
        <div class="filter-group">
          <label class="filter-label">Time</label>
          <div class="time-range">
            <div class="time-input-group">
              <input
                type="time"
                id="timeFrom"
                class="time-input"
                value="07:00"
              />
            </div>

            <span class="time-separator">to</span>

            <div class="time-input-group">
              <input type="time" id="timeTo" class="time-input" value="01:00" />
            </div>
          </div>
        </div>

        <!-- Actions -->
        <div class="filter-actions">
          <button
            type="button"
            class="filter-clear-btn"
            onclick="clearFilters()"
          >
            Clear
          </button>
          <button
            type="button"
            class="filter-apply-btn"
            onclick="applyFilters()"
          >
            Apply
          </button>
        </div>
      </div>
    </div>

    <!-- JavaScript Files -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="../static/script.js"></script>
    <script src="../static/filter-dashboard.js"></script>

    <script>
      // Kill Folium-injected global rules inside the map wrapper
      document
        .querySelectorAll(
          '.map-wrapper style, .map-wrapper link[rel="stylesheet"]'
        )
        .forEach((node) => {
          const css = (node.textContent || "").toLowerCase();
          if (
            css.includes("html") ||
            css.includes("body{") ||
            css.includes("html, body") ||
            css.includes("body, html")
          ) {
            node.remove();
          }
        });
    </script>
  </body>
</html>
